{% extends 'base.html.twig' %}


{% block content %}

    <div class="block-small">
        <form method="post"  id = "login-form">
        <head>
    

    <!-- Title -->
    <title>SoundOn</title>

    <!-- Favicon -->
    <link rel="icon" href="img/core-img/favicon.ico">

    <!-- Stylesheet -->
    <link rel="stylesheet" href="style.css">

</head>
<body>
 <div class="preloader d-flex align-items-center justify-content-center">
        <div class="lds-ellipsis">
            <div></div>
            <div></div>
            <div></div>
            <div></div>
        </div>
    </div>
    </body>
<div class="oneMusic-main-menu">
            <div class="classy-nav-container breakpoint-off">
                <div class="container">
                <nav class="classy-navbar justify-content-between" id="oneMusicNav">
                <a href="index.html" class="nav-brand"><img src="img/core-img/logo.png" alt=""></a>
                <div class="classy-navbar-toggler">
                            <span class="navbarToggler"><span></span><span></span><span></span></span>
                        </div>
                        <div class="classy-menu">
<div class="login-register-cart-button d-flex align-items-center">
    </div>
                            </div>
                            </div>
                    </nav>
                </div>
            </div>
        </div>
    </header>

<section class="breadcumb-area bg-img bg-overlay" style="background-image: url(/template/img/bg-img/breadcumb.jpg);">
        <div class="bradcumbContent">
            
            <h2>Connexion</h2>
        </div>
    </section>
    <section class="login-area section-padding-100">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-12 col-lg-8">
                    <div class="login-content">
                        <h3>Bienvenue</h3>
                        <!-- Login Form -->
            {% if error %}
                <div class="alert alert-danger">{{ error.messageKey|trans(error.messageData, 'security') }}</div>
            {% endif %}

            {% for message in app.flashes('notice') %}
                <div class="alert alert-info">{{ message }}</div>
            {% endfor %}

            {% if app.user %}
                <div class="mb-3">
                    
Vous êtes connecté en tant que {{ app.user.username }}, <a href="{{ path('app_logout') }}">Se déconnecter</a>
                </div>
            {% endif %}

            <h1 class="h3 mb-3 font-weight-normal">Merci de vous connecter a SoundOn</h1>
            <label for="inputEmail">Votre email</label>
            <input type="email" value="{{ last_username }}" name="email" id="inputEmail" class="form-control" placeholder="Votre adresse email" required autofocus>
            <label for="inputPassword">Votre mot de passe</label>
            <input type="password" name="password" id="inputPassword" class="form-control" placeholder="Votre mot de passe" required>
            
            <br>
            <div>
            
           
            <canvas id="captcha-canvas" width="200" height="70"></canvas>
            
            <button id="refresh-btn" type="button" class="btn ">Refresh</button>
 <br>
 <br>
             <input type="text" id="captcha" name="captcha" class="form-control">
           
            </div>

            <input type="hidden" name="_csrf_token"
                   value="{{ csrf_token('authenticate') }}"
            >

            <button class="btn oneMusic-btn mt-30" type="submit" id="submit-btn">
                Se connecter
            </button>
  <br>
                <a href="{{ path('app_forgot_password_request')}}" class="btn oneMusic-btn mt-30" role="button">reset password</a>
              <a href="{{ path('register')}}" class="btn oneMusic-btn mt-30" role="button">Créer un compte</a>
              
            
        </form>
    </div>

 <script>
    // Define the fonts and characters to use
const fonts = ["Arial", "Helvetica", "Times New Roman", "Georgia", "Verdana", "Courier"];
const characters = "abcdefghijklmnopqrstuvwxyz0123456789";

let captcha_v = ""
// Generate a random captcha code
function generateCaptcha() {
  let captcha = "";
  for (let i = 0; i < 6; i++) {
    captcha += characters.charAt(Math.floor(Math.random() * characters.length));
  }
  return captcha;
}

// Draw the captcha image on the canvas
function drawCaptcha() {
  const canvas = document.getElementById("captcha-canvas");
  const context = canvas.getContext("2d");
  
  // Clear the canvas
  context.clearRect(0, 0, canvas.width, canvas.height);
  
  // Set the background color and draw random lines
  context.fillStyle = "#f2f2f2";
  context.fillRect(0, 0, canvas.width, canvas.height);
  context.beginPath();
  for (let i = 0; i < 10; i++) {
    context.moveTo(Math.random() * canvas.width, Math.random() * canvas.height);
    context.lineTo(Math.random() * canvas.width, Math.random() * canvas.height);
    context.strokeStyle = "#ddd";
    context.stroke();
  }
  
  // Generate a random captcha code and set the font style
  const captchaCode = generateCaptcha();
    captcha_v = captchaCode;
  const font = fonts[Math.floor(Math.random() * fonts.length)];
  context.font = "bold 30px " + font;
  
  // Draw the captcha characters with random colors and positions
  for (let i = 0; i < captchaCode.length; i++) {
    context.fillStyle = "rgb(" + Math.floor(Math.random() * 256) + "," + Math.floor(Math.random() * 256) + "," + Math.floor(Math.random() * 256) + ")";
    context.fillText(captchaCode[i], 20 + i * 25, 40 + Math.random() * 10);
  }
  
  // Set the captcha code as the value of the input field
  //document.getElementById("captcha").setAttribute("value", captchaCode);
}

// Draw the captcha image on page load
window.addEventListener("load", drawCaptcha);

// Refresh the captcha image when the user clicks the "Refresh" button
document.getElementById("refresh-btn").addEventListener("click", drawCaptcha);

// Check if the user entered the correct captcha code
document.getElementById("submit-btn").addEventListener("click", function() {
    
  const captchaInput = document.getElementById("captcha").value;


  if (captchaInput.localeCompare(captcha_v) === 0) {
   
    document.getElementById("login-form").submit();
    
  } else {
    alert("Captcha code is incorrect. Please try again.");
    drawCaptcha();
    event.preventDefault();
  }
});

  </script>
{% endblock %}
